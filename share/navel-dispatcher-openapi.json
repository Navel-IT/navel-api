{
    "swagger": "2.0",
    "info": {
        "title": "navel-dispatcher",
        "description": "https://github.com/navel-it/navel-dispatcher",
        "version": "0.1.0",
        "contact": {
            "name": "Yoann Le Garff, Nicolas Boquet and Yann Le Bras"
        },
        "license": {
            "name": "Apache License, Version 2.0",
            "url": "http://www.apache.org/licenses/LICENSE-2.0.html"
        }
    },
    "basePath": "/api",
    "consumes": [
        "application/json"
    ],
    "produces": [
        "application/json"
    ],
    "paths": {
        "/status": {
            "get": {
                "summary": "Show product status",
                "operationId": "showStatus",
                "x-mojo-to": "Controller::OpenAPI::Product#show_status",
                "tags": [
                    "status"
                ],
                "responses": {
                    "200": {
                        "description": "Product status",
                        "schema": {
                            "type": "object",
                            "additionalProperties": false,
                            "required": [
                                "version"
                            ],
                            "properties": {
                                "version": {
                                    "type": [
                                        "string",
                                        "integer",
                                        "number"
                                    ]
                                }
                            }
                        }
                    },
                    "default": {
                        "$ref": "#/responses/unexpectedError"
                    }
                }
            }
        },
        "/save_configuration": {
            "put": {
                "summary": "Save configuration",
                "operationId": "saveConfiguration",
                "x-mojo-to": "Controller::OpenAPI::Configuration#save",
                "tags": [
                    "backup",
                    "configuration"
                ],
                "responses": {
                    "200": {
                        "$ref": "#/responses/oKKO"
                    },
                    "default": {
                        "$ref": "#/responses/unexpectedError"
                    }
                }
            }
        },
        "/meta": {
            "get": {
                "summary": "Show meta configuration",
                "operationId": "showMeta",
                "x-mojo-to": "Controller::OpenAPI::Meta#show",
                "tags": [
                    "meta"
                ],
                "responses": {
                    "200": {
                        "description": "Meta configuration",
                        "schema": {
                            "$ref": "#/definitions/meta"
                        }
                    },
                    "default": {
                        "$ref": "#/responses/unexpectedError"
                    }
                }
            }
        },
        "/jobs": {
            "get": {
                "summary": "List job types",
                "operationId": "listJobTypes",
                "x-mojo-to": "Controller::OpenAPI::Job#list_types",
                "tags": [
                    "job"
                ],
                "responses": {
                    "200": {
                        "description": "Job types",
                        "schema": {
                            "type": "array",
                            "items": {
                                "type": "string",
                                "minLength": 1
                            }
                        }
                    },
                    "default": {
                        "$ref": "#/responses/unexpectedError"
                    }
                }
            }
        },
        "/jobs/{type}": {
            "get": {
                "summary": "List job names by job type",
                "operationId": "listJobNamesByJobType",
                "x-mojo-to": "Controller::OpenAPI::Job#list_by_type",
                "tags": [
                    "job"
                ],
                "parameters": [
                    {
                        "$ref": "#/parameters/type"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Job names by job type",
                        "schema": {
                            "type": "array",
                            "items": {
                                "type": "string",
                                "minLength": 1
                            }
                        }
                    },
                    "404": {
                        "$ref": "#/responses/resourceCouldNotBeFound"
                    },
                    "default": {
                        "$ref": "#/responses/unexpectedError"
                    }
                }
            }
        },
        "/jobs/{type}/{name}": {
            "get": {
                "summary": "Show the properties of a job",
                "operationId": "showJobByTypeAndName",
                "x-mojo-to": "Controller::OpenAPI::Job#show_by_type_and_name",
                "tags": [
                    "job"
                ],
                "parameters": [
                    {
                        "$ref": "#/parameters/type"
                    },
                    {
                        "$ref": "#/parameters/name"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Job",
                        "schema": {
                            "$ref": "#/definitions/job"
                        }
                    },
                    "404": {
                        "$ref": "#/responses/resourceCouldNotBeFound"
                    },
                    "default": {
                        "$ref": "#/responses/unexpectedError"
                    }
                }
            }
        },
        "/jobs/{type}/{name}/enable": {
            "put": {
                "summary": "Enable a job",
                "operationId": "enableJobByTypeAndName",
                "x-mojo-to": "Controller::OpenAPI::Job#enable_by_type_and_name",
                "tags": [
                    "job"
                ],
                "parameters": [
                    {
                        "$ref": "#/parameters/type"
                    },
                    {
                        "$ref": "#/parameters/name"
                    }
                ],
                "responses": {
                    "200": {
                        "$ref": "#/responses/oKKO"
                    },
                    "404": {
                        "$ref": "#/responses/resourceCouldNotBeFound"
                    },
                    "default": {
                        "$ref": "#/responses/unexpectedError"
                    }
                }
            }
        },
        "/jobs/{type}/{name}/disable": {
            "put": {
                "summary": "Disable a job",
                "operationId": "disableJobByTypeAndName",
                "x-mojo-to": "Controller::OpenAPI::Job#disable_by_type_and_name",
                "tags": [
                    "job"
                ],
                "parameters": [
                    {
                        "$ref": "#/parameters/type"
                    },
                    {
                        "$ref": "#/parameters/name"
                    }
                ],
                "responses": {
                    "200": {
                        "$ref": "#/responses/oKKO"
                    },
                    "404": {
                        "$ref": "#/responses/resourceCouldNotBeFound"
                    },
                    "default": {
                        "$ref": "#/responses/unexpectedError"
                    }
                }
            }
        },
        "/jobs/{type}/{name}/execute": {
            "put": {
                "summary": "Execute a job",
                "operationId": "executeJobByTypeAndName",
                "x-mojo-to": "Controller::OpenAPI::Job#execute_by_type_and_name",
                "tags": [
                    "job"
                ],
                "parameters": [
                    {
                        "$ref": "#/parameters/type"
                    },
                    {
                        "$ref": "#/parameters/name"
                    }
                ],
                "responses": {
                    "200": {
                        "$ref": "#/responses/oKKO"
                    },
                    "404": {
                        "$ref": "#/responses/resourceCouldNotBeFound"
                    },
                    "default": {
                        "$ref": "#/responses/unexpectedError"
                    }
                }
            }
        },
        "/storekeepers": {
            "get": {
                "summary": "List storekeeper names",
                "operationId": "listStorekeeperNames",
                "x-mojo-to": "Controller::OpenAPI::Storekeeper#list",
                "tags": [
                    "storekeeper"
                ],
                "responses": {
                    "200": {
                        "description": "Storekeeper names",
                        "schema": {
                            "type": "array",
                            "items": {
                                "type": "string",
                                "minLength": 1
                            }
                        }
                    },
                    "default": {
                        "$ref": "#/responses/unexpectedError"
                    }
                }
            },
            "post": {
                "summary": "Create a storekeeper",
                "operationId": "createStorekeeper",
                "x-mojo-to": "Controller::OpenAPI::Storekeeper#create",
                "tags": [
                    "storekeeper"
                ],
                "parameters": [
                    {
                        "$ref": "#/parameters/definition"
                    }
                ],
                "responses": {
                    "201": {
                        "$ref": "#/responses/oKKO"
                    },
                    "400": {
                        "$ref": "#/responses/badRequest"
                    },
                    "409": {
                        "$ref": "#/responses/resourceAlreadyExists"
                    },
                    "default": {
                        "$ref": "#/responses/unexpectedError"
                    }
                }
            }
        },
        "/storekeepers/{name}": {
            "get": {
                "summary": "Show the properties of a storekeeper",
                "operationId": "showStorekeeper",
                "x-mojo-to": "Controller::OpenAPI::Storekeeper#show",
                "tags": [
                    "storekeeper"
                ],
                "parameters": [
                    {
                        "$ref": "#/parameters/name"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Storekeeper",
                        "schema": {
                            "$ref": "#/definitions/storekeeper"
                        }
                    },
                    "404": {
                        "$ref": "#/responses/resourceCouldNotBeFound"
                    },
                    "default": {
                        "$ref": "#/responses/unexpectedError"
                    }
                }
            },
            "put": {
                "summary": "Update a storekeeper",
                "operationId": "updateStorekeeper",
                "x-mojo-to": "Controller::OpenAPI::Storekeeper#update",
                "tags": [
                    "storekeeper"
                ],
                "parameters": [
                    {
                        "$ref": "#/parameters/name"
                    },
                    {
                        "$ref": "#/parameters/baseDefinition"
                    }
                ],
                "responses": {
                    "200": {
                        "$ref": "#/responses/oKKO"
                    },
                    "400": {
                        "$ref": "#/responses/badRequest"
                    },
                    "404": {
                        "$ref": "#/responses/resourceCouldNotBeFound"
                    },
                    "default": {
                        "$ref": "#/responses/unexpectedError"
                    }
                }
            },
            "delete": {
                "summary": "Delete a storekeeper",
                "operationId": "deleteStorekeeper",
                "x-mojo-to": "Controller::OpenAPI::Storekeeper#delete",
                "tags": [
                    "storekeeper"
                ],
                "parameters": [
                    {
                        "$ref": "#/parameters/name"
                    }
                ],
                "responses": {
                    "200": {
                        "$ref": "#/responses/oKKO"
                    },
                    "400": {
                        "$ref": "#/responses/badRequest"
                    },
                    "404": {
                        "$ref": "#/responses/resourceCouldNotBeFound"
                    },
                    "default": {
                        "$ref": "#/responses/unexpectedError"
                    }
                }
            }
        },
        "/storekeepers/{name}/worker": {
            "get": {
                "summary": "Show informations on the worker of a storekeeper",
                "operationId": "showWorkerStatusOfAStorekeeper",
                "x-mojo-to": "Controller::OpenAPI::Storekeeper#show_worker_status",
                "tags": [
                    "storekeeper",
                    "worker"
                ],
                "parameters": [
                    {
                        "$ref": "#/parameters/name"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Worker's informations",
                        "schema": {
                            "type": "object",
                            "additionalProperties": false,
                            "required": [
                                "healthy",
                                "initialized"
                            ],
                            "properties": {
                                "healthy": {
                                    "type": [
                                        "integer",
                                        "boolean"
                                    ],
                                    "minimum": 0,
                                    "maximum": 1
                                },
                                "initialized": {
                                    "type": [
                                        "integer",
                                        "boolean"
                                    ],
                                    "minimum": 0,
                                    "maximum": 1
                                }
                            }
                        }
                    },
                    "400": {
                        "$ref": "#/responses/badRequest"
                    },
                    "404": {
                        "$ref": "#/responses/resourceCouldNotBeFound"
                    },
                    "default": {
                        "$ref": "#/responses/unexpectedError"
                    }
                }
            }
        },
        "/storekeepers/{name}/worker/database/connection": {
            "get": {
                "summary": "Show the connection status of the database associated with a storekeeper",
                "operationId": "showDatabaseConnectionStatusAssociatedWithStorekeeper",
                "x-mojo-to": "Controller::OpenAPI::Storekeeper#show_associated_database_connection_status",
                "tags": [
                    "storekeeper",
                    "worker",
                    "database",
                    "connection"
                ],
                "parameters": [
                    {
                        "$ref": "#/parameters/name"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Database connection status",
                        "schema": {
                            "type": "object",
                            "additionalProperties": false,
                            "required": [
                                "active_connections"
                            ],
                            "properties": {
                                "active_connections": {
                                    "type": "integer",
                                    "minimum": 0
                                }
                            }
                        }
                    },
                    "400": {
                        "$ref": "#/responses/badRequest"
                    },
                    "404": {
                        "$ref": "#/responses/resourceCouldNotBeFound"
                    },
                    "default": {
                        "$ref": "#/responses/unexpectedError"
                    }
                }
            }
        },
        "/storekeepers/{name}/worker/consumer/queue": {
            "get": {
                "summary": "Show informations on the consumer queue associated with a storekeeper",
                "operationId": "showConsumerQueueAssociatedWithStorekeeper",
                "x-mojo-to": "Controller::OpenAPI::Storekeeper#show_associated_consumer_queue",
                "tags": [
                    "storekeeper",
                    "worker",
                    "consumer",
                    "queue"
                ],
                "parameters": [
                    {
                        "$ref": "#/parameters/name"
                    }
                ],
                "responses": {
                    "200": {
                        "$ref": "#/responses/queueStatus"
                    },
                    "400": {
                        "$ref": "#/responses/badRequest"
                    },
                    "404": {
                        "$ref": "#/responses/resourceCouldNotBeFound"
                    },
                    "default": {
                        "$ref": "#/responses/unexpectedError"
                    }
                }
            },
            "delete": {
                "summary": "Delete all events in the consumer queue associated with a storekeeper",
                "operationId": "deleteAllEventsFromConsumerQueueAssociatedWithStorekeeper",
                "x-mojo-to": "Controller::OpenAPI::Storekeeper#delete_all_events_from_associated_consumer_queue",
                "tags": [
                    "storekeeper",
                    "consumer",
                    "queue"
                ],
                "parameters": [
                    {
                        "$ref": "#/parameters/name"
                    }
                ],
                "responses": {
                    "200": {
                        "$ref": "#/responses/oKKO"
                    },
                    "400": {
                        "$ref": "#/responses/badRequest"
                    },
                    "404": {
                        "$ref": "#/responses/resourceCouldNotBeFound"
                    },
                    "default": {
                        "$ref": "#/responses/unexpectedError"
                    }
                }
            }
        },
        "/storekeepers/{name}/worker/consumer/connection": {
            "get": {
                "summary": "Show the connection status of the consumer associated with a storekeeper",
                "operationId": "showConsumerConnectionStatusAssociatedWithStorekeeper",
                "x-mojo-to": "Controller::OpenAPI::Storekeeper#show_associated_consumer_connection_status",
                "tags": [
                    "storekeeper",
                    "worker",
                    "consumer",
                    "connection"
                ],
                "parameters": [
                    {
                        "$ref": "#/parameters/name"
                    }
                ],
                "responses": {
                    "200": {
                        "$ref": "#/responses/couldBeConnectableConnectionStatus"
                    },
                    "400": {
                        "$ref": "#/responses/badRequest"
                    },
                    "404": {
                        "$ref": "#/responses/resourceCouldNotBeFound"
                    },
                    "default": {
                        "$ref": "#/responses/unexpectedError"
                    }
                }
            }
        },
        "/storekeepers/{name}/worker/publisher/queue": {
            "get": {
                "summary": "Show informations on the publisher queue associated with a storekeeper",
                "operationId": "showPublisherQueueAssociatedWithStorekeeper",
                "x-mojo-to": "Controller::OpenAPI::Storekeeper#show_associated_publisher_queue",
                "tags": [
                    "storekeeper",
                    "worker",
                    "publisher",
                    "queue"
                ],
                "parameters": [
                    {
                        "$ref": "#/parameters/name"
                    }
                ],
                "responses": {
                    "200": {
                        "$ref": "#/responses/queueStatus"
                    },
                    "400": {
                        "$ref": "#/responses/badRequest"
                    },
                    "404": {
                        "$ref": "#/responses/resourceCouldNotBeFound"
                    },
                    "default": {
                        "$ref": "#/responses/unexpectedError"
                    }
                }
            },
            "delete": {
                "summary": "Delete all events in the publisher queue associated with a storekeeper",
                "operationId": "deleteAllEventsFromPublisherQueueAssociatedWithStorekeeper",
                "x-mojo-to": "Controller::OpenAPI::Storekeeper#delete_all_events_from_associated_publisher_queue",
                "tags": [
                    "storekeeper",
                    "publisher",
                    "queue"
                ],
                "parameters": [
                    {
                        "$ref": "#/parameters/name"
                    }
                ],
                "responses": {
                    "200": {
                        "$ref": "#/responses/oKKO"
                    },
                    "400": {
                        "$ref": "#/responses/badRequest"
                    },
                    "404": {
                        "$ref": "#/responses/resourceCouldNotBeFound"
                    },
                    "default": {
                        "$ref": "#/responses/unexpectedError"
                    }
                }
            }
        },
        "/storekeepers/{name}/worker/publisher/connection": {
            "get": {
                "summary": "Show the connection status of the publisher associated with a storekeeper",
                "operationId": "showPublisherConnectionStatusAssociatedWithStorekeeper",
                "x-mojo-to": "Controller::OpenAPI::Storekeeper#show_associated_publisher_connection_status",
                "tags": [
                    "storekeeper",
                    "worker",
                    "publisher",
                    "connection"
                ],
                "parameters": [
                    {
                        "$ref": "#/parameters/name"
                    }
                ],
                "responses": {
                    "200": {
                        "$ref": "#/responses/couldBeConnectableConnectionStatus"
                    },
                    "400": {
                        "$ref": "#/responses/badRequest"
                    },
                    "404": {
                        "$ref": "#/responses/resourceCouldNotBeFound"
                    },
                    "default": {
                        "$ref": "#/responses/unexpectedError"
                    }
                }
            }
        }
    },
    "definitions": {
        "meta": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "storekeepers"
            ],
            "properties": {
                "storekeepers": {
                    "type": "object",
                    "additionalProperties": false,
                    "required": [
                        "definitions_from_file",
                        "maximum"
                    ],
                    "properties": {
                        "definitions_from_file": {
                            "type": "string",
                            "minLength": 1
                        },
                        "maximum": {
                            "type": "integer",
                            "minimum": 0
                        }
                    }
                }
            }
        },
        "job": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "name",
                "type",
                "backend",
                "enabled",
                "singleton",
                "running"
            ],
            "properties": {
                "name": {
                    "type": "string",
                    "minLength": 1
                },
                "type": {
                    "type": "string",
                    "minLength": 1
                },
                "backend": {
                    "type": "string",
                    "minLength": 1
                },
                "enabled": {
                    "type": [
                        "integer",
                        "boolean"
                    ],
                    "minimum": 0,
                    "maximum": 1
                },
                "singleton": {
                    "type": [
                        "integer",
                        "boolean"
                    ],
                    "minimum": 0,
                    "maximum": 1
                },
                "running": {
                    "type": "integer",
                    "minimum": 0
                }
            }
        },
        "baseStorekeeper": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "name": {
                    "type": "string",
                    "minLength": 1
                },
                "database_tls": {
                    "type": [
                        "integer",
                        "boolean"
                    ],
                    "minimum": 0,
                    "maximum": 1
                },
                "database_tls_verify": {
                    "type": [
                        "integer",
                        "boolean"
                    ],
                    "minimum": 0,
                    "maximum": 1
                },
                "database_tls_ca_cert": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "minLength": 1
                },
                "database_user": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "minLength": 1
                },
                "database_password": {
                    "type": [
                        "string",
                        "null"
                    ]
                },
                "database_host": {
                    "type": "string",
                    "minLength": 1
                },
                "database_port": {
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 65535
                },
                "database_basepath": {
                    "type": "string",
                    "minLength": 1
                },
                "consumer_queue_size" : {
                    "type": "integer",
                    "minimum": 0
                },
                "consumer_backend": {
                    "type": "string",
                    "minLength": 1
                },
                "consumer_backend_input": {},
                "publisher_queue_size" : {
                    "type": "integer",
                    "minimum": 0
                },
                "publisher_backend": {
                    "type": "string",
                    "minLength": 1
                },
                "publisher_backend_input": {}
            }
        },
        "storekeeper": {
            "allOf": [
                {
                    "$ref": "#/definitions/baseStorekeeper"
                },
                {
                    "type": "object",
                    "required": [
                        "name",
                        "database_tls",
                        "database_tls_verify",
                        "database_tls_ca_cert",
                        "database_user",
                        "database_password",
                        "database_host",
                        "database_port",
                        "database_basepath",
                        "consumer_queue_size",
                        "consumer_backend",
                        "consumer_backend_input",
                        "publisher_queue_size",
                        "publisher_backend",
                        "publisher_backend_input"
                    ]
                }
            ]
        },
        "oKKO": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "ok",
                "ko"
            ],
            "properties": {
                "ok": {
                    "type": "array",
                    "items": {}
                },
                "ko": {
                    "type": "array",
                    "items": {}
                }
            }
        }
    },
    "parameters": {
        "type": {
            "name": "type",
            "in": "path",
            "required": true,
            "type": "string"
        },
        "name": {
            "name": "name",
            "in": "path",
            "required": true,
            "type": "string"
        },
        "baseDefinition": {
            "name": "baseDefinition",
            "in": "body",
            "required": true,
            "schema": {
                "$ref": "#/definitions/baseStorekeeper"
            }
        },
        "definition": {
            "name": "definition",
            "in": "body",
            "required": true,
            "schema": {
                "$ref": "#/definitions/storekeeper"
            }
        }
    },
    "responses": {
        "queueStatus": {
            "description": "Queue status",
            "schema": {
                "type": "object",
                "additionalProperties": false,
                "required": [
                    "amount_of_events"
                ],
                "properties": {
                    "amount_of_events": {
                        "type": "integer",
                        "minimum": 0
                    }
                }
            }
        },
        "couldBeConnectableConnectionStatus": {
            "description": "Connection status",
            "schema": {
                "type": "object",
                "additionalProperties": false,
                "required": [
                    "connectable",
                    "connecting",
                    "connected",
                    "disconnecting",
                    "disconnected"
                ],
                "properties": {
                    "connectable": {
                        "type": [
                            "integer",
                            "boolean"
                        ],
                        "minimum": 0,
                        "maximum": 1
                    },
                    "connecting": {
                        "type": [
                            "integer",
                            "boolean"
                        ],
                        "minimum": 0,
                        "maximum": 1
                    },
                    "connected": {
                        "type": [
                            "integer",
                            "boolean"
                        ],
                        "minimum": 0,
                        "maximum": 1
                    },
                    "disconnecting": {
                        "type": [
                            "integer",
                            "boolean"
                        ],
                        "minimum": 0,
                        "maximum": 1
                    },
                    "disconnected": {
                        "type": [
                            "integer",
                            "boolean"
                        ],
                        "minimum": 0,
                        "maximum": 1
                    }
                }
            }
        },
        "oKKO": {
            "description": "OK and KO messages",
            "schema": {
                "$ref": "#/definitions/oKKO"
            }
        },
        "badRequest": {
            "description": "Incorrect request",
            "schema": {
                "$ref": "#/definitions/oKKO"
            }
        },
        "resourceCouldNotBeFound": {
            "description": "This resource could not be found",
            "schema": {
                "$ref": "#/definitions/oKKO"
            }
        },
        "resourceAlreadyExists": {
            "description": "This resource already exists",
            "schema": {
                "$ref": "#/definitions/oKKO"
            }
        },
        "unexpectedError": {
            "description": "Unexpected Error",
            "schema": {
                "$ref": "#/definitions/oKKO"
            }
        }
    }
}
